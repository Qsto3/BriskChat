function loadingStart(){$(".ui.main.container").css("display","none");$(".ui.dimmer").addClass("active")}function loadingStop(){$(".ui.main.container").css("display","block");$(".ui.dimmer").removeClass("active");addActionsToMessages();console.log("Loader stops")}function addActionsToMessages(){$(".ts-message").not(":has(> .action_hover_container), #message_edit_container").each(function(){if($(this).find(".message_sender").text()!==globalUserName||$(this).find(".member_image").data("member-id")!==globalUserId)return!0;$(this).prepend('<div class="action_hover_container stretch_btn_heights narrow_buttons" data-js="action_hover_container" data-show_rxn_action="true">            <button type="button" data-action="edit" class="btn_unstyle btn_msg_action ts_tip" data-content="Edit message" data-position="top center">            <i class="edit icon"><\/i>            <\/button>            <button type="button" data-action="delete" class="btn_unstyle btn_msg_action ts_tip danger" data-content="Delete message" data-position="top center">            <i class="delete icon"><\/i>            <\/button>            <\/div>')})}function addEditContainer(n,t,i){return'<div class="ts-message message highlight" id="message_edit_container">            <div class="message_gutter">                <div class="message_icon">                    '+i+'                <\/div>            <\/div>            <form id="message_edit_form" data-id="'+n+'">                <button class="btn_unstyle emo_menu" aria-label="Emoji menu" type="button">                    <i class="meh icon"><\/i>                <\/button>                <div id="msg_text" class="message_input ql-container focus">                    <div class="ql-editor" role="textbox" tabindex="0" aria-multiline="true" aria-haspopup="true" spellcheck="true" contenteditable="true"><p>'+t+'<\/p><\/div>                    <div class="ql-clipboard" tabindex="-1" aria-hidden="true" role="presentation" spellcheck="true" contenteditable="true"><\/div>                <\/div>                <a id="cancel_edit" role="button" class="ui button mini">Cancel<\/a>                <a id="commit_edit" role="button" class="ui button mini positive"><i class="icon edit"><\/i>Save Changes<\/a>                <span id="message_editing_info" class="mini" style="display: none;">Finish editing this message first! Or press <strong>escape<\/strong> if youve changed your mind.<\/span>            <\/form>        <\/div>'}function emoReplacer(){for(var t={1:"smile",2:"smile_big",3:"sad",4:"tongue",5:"crying",6:"wink"},i=Array.slice(arguments),n=1;n<i.length-2;n++)if(i[n])return'<img src="/images/emoticons/'+t[n]+'.png" alt="'+t[n]+'" title="'+t[n]+'">'}function parseEmoticons(n){var t=new RegExp("(:-?[)])|(:-?[D])|(:-?[(])|(:-?[P])|(;-?[(])|(;-?[)])","gi");return n.replace(t,emoReplacer)}function getMessageHtml(n,t,i,r,u){return'<div class="ts-message" data-id="'+i+'"><div class="message_gutter"><div class="message_icon"><a href="/team/malgosia" target="/team/malgosia" class="member_image" data-member-id="'+t+'" style="background-image: url(\'../images/troll.png\')" aria-hidden="true" tabindex="-1"> <\/a><\/div><\/div><div class="message_content"><div class="message_content_header"><a href="#" class="message_sender">'+n+'<\/a><a href="#" class="timestamp">'+u+'<\/a><\/div><span class="message_body">'+Autolinker.link(r)}function updateChannelsCount(n){var t=$("#channelsCount").text().match(/\d+/);t=parseInt(t)+n;$("#channelsCount").text("CHANNELS ("+t+")")}function serializeForm(n){data=$(n).serializeArray();var t={};return $.each(data,function(n,i){t[i.name]=i.value}),t}function customization(){var n,t;myHub.server.getRoomInformation(currentRoomId);n='<div class="item">                            <div class="ui styled accordion">                                    <div class="accordion">                                        <div class="title"><i class="theme icon"><\/i>Customization<\/div>                                        <div class="content" id="customization">                                            <div class="ui form">                                                <div class="field">                                                    <select id="selecttheme" class="ui dropdown" onchange="selectTheme(this);">                                                        <option value="0">Black<\/option>                                                        <option value="1">Blue<\/option>                                                        <option value="2">Green<\/option>                                                        <option value="3">Orange<\/option>                                                        <option value="4">Pink<\/option>                                                    <\/select>                                                <\/div>                                            <\/div>                                        <\/div>                                        <div class="title"><i class="wpforms icon"><\/i>Description<\/div>                                        <div class="content" id="Description">                                            <div class="ui form">                                                <div class="field">                                                <input type="text" id="infoDescription">                                                <\/div>                                            <\/div>                                        <\/div>                                        <div class="title"><i class="wpforms icon"><\/i>Room Name<\/div>                                        <div class="content" id="roomName">                                            <div class="ui form">                                                <div class="field">                                                <input type="text" id="infoName">                                                <\/div>                                            <\/div>                                        <\/div>                                        <div class="title"><i class="delete icon"><\/i>Delete Room<\/div>                                        <div class="content" id="deleteRoom">                                            <div class="ui two column centered grid">                                                    <div class="ui form ">                                                        <div class="field">                                                            <button class="negative ui button" id="deleteRoomButton" data-inverted="" data-tooltip="Irrevocable removal of the room" data-position="bottom center" onclick="deleteRoom();">Delete Room<\/button>                                                        <\/div>                                                    <\/div>                                                <\/div>                                         <\/div>                                    <\/div>                            <\/div>                        <\/div>';$("#deleteRoomButton").popup({variation:"inverted"});t='<div class="bottom attached centered ui item">                            <div class="ui buttons" tabindex="0"><button class="ui button" onclick="closeRightBarCallback();">Cancel<\/button>                                <div class="or"><\/div>                                <button class="ui positive button" onclick="changeSettingsValue(currentTheme);">Save<\/button>                            <\/div>                        <\/div>';$("#Rrightbar").append(n);$("#rightsidebarblock").append(t);$(".ui.styled.accordion").accordion()}function membersInRoom(){$("#Rrightbar").html("");$("#rightbar_Title").html("Channel Details");$("#Rrightbar").append('<div class="ui styled accordion"><div class="active content"><div class="accordion"><div class="title"><i class="dropdown icon"><\/i><i class="info icon"><\/i>About<\/div><div class="content" id="aboutInfo"><\/div><div class="title"><i class="dropdown icon"><\/i><i class="users icon"><\/i>Members<\/div><div class="content" id="MembersInRoom"><\/div><\/div><\/div><\/div>');$(".ui.styled.accordion").accordion();myHub.server.getRoomUsers(currentRoomId)}function changeSettingsValue(n){var r=parseInt(currentTheme),t=$("#infoDescription").val(),i=$("#infoName").val();roomNameInDatabase!==i&&myHub.server.editRoomName(currentRoomId,i);descriptionInDatabase!==t&&myHub.server.editRoomDescription(currentRoomId,t);themeInDatabase!==n&&myHub.server.editRoomCustomization(currentRoomId,r);$(".ui.sidebar.right").removeClass("visible")}function changeTheme(n){switch(n){case"0":leftbar="#1B1C1D";break;case"1":leftbar="#0080ff";break;case"2":leftbar="#33CC00";break;case"3":leftbar="#FF9900";break;case"4":leftbar="#D15CC1";break;default:leftbar="#1B1C1D"}$(".ui.sidebar.left").css("background-color",leftbar)}function selectTheme(n){currentTheme=n.value;changeTheme(currentTheme)}var Autolinker,globalDomainName,globalUserName,globalUserId,currentTheme,descriptionInDatabase,roomNameInDatabase,myHub,closeRightBarCallback;$(".ui.sidebar.left").sidebar("setting",{transition:"overlay"});$(".ui.sidebar.right").first().sidebar();$(document).on("reloadPopups",function(){$(".ts_tip").popup({variation:"inverted"});$(".item > .btn_unstyle.right").popup({variation:"inverted"})});Autolinker=new Autolinker({stripPrefix:!1,stripTrailingSlash:!1});$(window).resize(function(){var n=117,t;$(".ui.message").length&&($(".ui.message").hasClass("hidden")||(n+=51));$("#chat_messages").height($(window).height()-n);t=165;$(".sidebar_channels_messages").height($(window).height()-t)});$(window).trigger("resize");currentRoomId=0;$.connection.hub.url="http://localhost:52284/signalr";myHub=$.connection.channelHub;$("#channelsCount").click(function(){console.log("Click na licznik kanałów");myHub.server.getDomainPublicRooms()});$(".menu").on("click",".menu > a.item",function(n){currentRoomId!==$(n.target).data("id")&&(loadingStart(),$("#chat_messages").empty(),myHub.server.leaveRoom(currentRoomId),$(".menu > a.item.active").removeClass("active"),$.when(myHub.server.joinRoom($(n.target).data("id"))).then(function(){currentRoomId=$(n.target).data("id");$(n.target).addClass("active");$("#channel_title").html($(n.target).html());getRoomInformation=myHub.server.getRoomInformation(currentRoomId);$.when(getRoomInformation).then(function(){loadingStop()})}))});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='edit']",function(n){function i(n){console.log("Click listener");$(document).find("#message_edit_container").length&&($(n.target).parents().addBack().is("#message_edit_container")||(console.log("Kliknięto poza. Usuwam #MEC"),document.removeEventListener("click",i,!0),$(document).find("#message_edit_container").prev().show(),$(document).find("#message_edit_container").remove()))}var r,e;$(document).find("#message_edit_container").length&&($(document).find("#message_edit_container").prev().show(),$(document).find("#message_edit_container").remove());var t=$(n.target).closest(".ts-message"),u=t.data("id"),f=t.find(".message_body").text();t.hide();t.after(addEditContainer(u,f,t.find(".message_icon").html()));$(".ql-editor").focus();r=document.createRange();r.selectNodeContents($(".ql-editor").get(0));r.collapse(!1);e=window.getSelection();e.removeAllRanges();e.addRange(r);$(document).find("#message_edit_container").length&&document.addEventListener("click",i,!0);$(".ts-message").on("click","#cancel_edit",function(n){document.removeEventListener("click",i,!0);t.show();$(n.target).closest("#message_edit_container").remove()});$("#message_edit_container").keydown(function(n){n.keyCode===27&&(document.removeEventListener("click",i,!0),$(document).find("#message_edit_container").prev().show(),$(document).find("#message_edit_container").remove())});$("#message_edit_form").keypress(function(n){if(n.which===13&&!n.shiftKey){if(f!==$(".ql-editor").text().trim()){var r;r===$(".ql-editor").text().trim()&&(console.log("Edytuję: "+r+" do pokoju "+currentRoomId),myHub.server.editMessage(currentRoomId,u,r))}document.removeEventListener("click",i,!0);t.show();$(n.target).closest("#message_edit_container").remove()}});$(".ts-message").on("click","#commit_edit",function(n){if(f!==$(".ql-editor").text().trim()){var r=$(".ql-editor").text().trim();r&&(console.log("Edytuję: "+r+" do pokoju "+currentRoomId),myHub.server.editMessage(currentRoomId,u,r))}document.removeEventListener("click",i,!0);t.show();$(n.target).closest("#message_edit_container").remove()})});$(".grid").on("click",".private-conversation-row",function(n){var t=$(n.target).hasClass(".private-conversation-row")?n.target:$(n.target).closest(".private-conversation-row");var i=$(t).data("name"),r=$(t).data("id"),u=$("#inputtext");u.before('<span class="private-conversation-tag" data-id="'+r+'">'+i+"<\/span>")});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='delete']",function(n){$(".ui.delete.modal").modal({onApprove:function(){var t=$(n.target).closest(".ts-message").data("id");myHub.server.deleteMessage(currentRoomId,t)}}).modal("show")});myHub.client.broadcastEditedMessage=function(n,t){var f=$(".ts-message[data-id='"+n+"']"),i=f.find(".message_body"),r,u;i.first().html(Autolinker.link(parseEmoticons(t)));r=t.match(/watch\?v=([a-zA-Z0-9\-_]+)/);r?(u='<iframe src="https://www.youtube.com/embed/'+r[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe>',i.last().hasClass("youtube_iframe")?i.last().html(u):i.last().after(u)):i.last().hasClass("youtube_iframe")&&i.last().hide("slow",function(){i.last().remove()})};myHub.client.broadcastMessage=function(n,t,i,r,u){var f=getMessageHtml(n,t,i,r,u),e=r.match(/watch\?v=([a-zA-Z0-9\-_]+)/);f+=e?'<\/span><span class="message_body youtube_iframe"><iframe src="https://www.youtube.com/embed/'+e[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe><\/span><\/div><\/div>':"<\/span><\/div><\/div>";$("#chat_messages").append(f);$("#chat_messages").clearQueue();$("#chat_messages").animate({scrollTop:$("#chat_messages")[0].scrollHeight},"slow");addActionsToMessages();$(document).trigger("reloadPopups")};myHub.client.deleteMessage=function(n){var t=$(".ts-message[data-id='"+n+"']");console.log("Klient usuwa wiadomosc o ID: "+t.data("id"));t.hide("slow",function(){t.remove()})};myHub.client.loadRooms=function(n){var t=!0;$("#channelsCount").text("CHANNELS ("+n.length+")");$.each(n,function(n,i){var r='<a class="item';t&&(r+=" active",t=!1,currentRoomId=i.Id);r+='"data-id="'+i.Id+'" data-ispublic="'+i.IsPublic+'">';r+=i.IsPublic?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=i.Name+"<\/a>";$("#channelsMenu").append(r)})};myHub.client.loadDomainPublicRooms=function(n){var i=!0,t;$.each(n,function(n,t){var r='<a class="item';i&&(r+=" active",i=!1,currentRoomId=t.Id);r+='"data-id="'+t.Id+'" data-ispublic="'+t.IsPublic+'">';r+=t.IsPublic?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=t.Name+"<\/a>";$("#channelsMenu").append(r)});t={};$("#channelsMenu > .item").filter(function(){var n=$(this).data("id");return t[n]?($(this).remove(),!1):(t[n]=!0,!0)});$("#channelsCount").text("CHANNELS ("+$("#channelsMenu > .item").length+")")};myHub.client.loadPrivateConversations=function(n){$.each(n,function(n,t){var i='<a class="item" data-id="'+t.Id+'"><i class="icon left">#<\/i>'+t.Name+"<\/a>";$("#privateConversationsMenu").append(i)})};myHub.client.parseLastMessages=function(n){$.each(n,function(n,t){var i=getMessageHtml(t.UserName,t.UserId,t.Id,t.Text,t.CreatedOn),r=t.Text.match(/watch\?v=([a-zA-Z0-9\-_]+)/);i+=r?'<\/span><span class="message_body youtube_iframe"><iframe src="https://www.youtube.com/embed/'+r[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe><\/span><\/div><\/div>':"<\/span><\/div><\/div>";$("#chat_messages").append(i)});$(".ui.main.container").css("display","block");$("#chat_messages").clearQueue();$("#chat_messages").animate({scrollTop:$("#chat_messages")[0].scrollHeight},"slow");addActionsToMessages();$(document).trigger("reloadPopups")};myHub.client.channelAddedAction=function(n,t,i){var r='<a class="item" data-id="'+t+'" data-ispublic="'+i+'">';r+=i?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=n+"<\/a>";$("#channelsMenu").append(r);updateChannelsCount(1);loadingStop()};myHub.client.privateConversationAddedAction=function(n){var t='<a class="item" data-id="'+n.Id+'"><i class="icon left">#<\/i>'+n.Name+"<\/a>";$("#privateConversationsMenu").append(t);loadingStop()};myHub.client.privateConversationsUsersLoadedAction=function(n){$("#privateConversationsUserList").empty();$.each(n,function(n,t){var i='<div class="row private-conversation-row" data-id="'+t.Id+'" data-name="'+t.Name+'">';i+='<div class="eight wide column"><b>'+t.UserName+"<\/b> ";i+=t.IsOnline?'<i class="circle icon green"><\/i>':'<i class="circle thin icon"><\/i>';i+=t.Name+"<\/div>";i+='<div class="four wide column"><\/div>';i+='<div class="four wide column mycheckmark"><i class="checkmark icon"><\/i><\/div>';i+="<\/div>";$("#privateConversationsUserList").append(i)})};myHub.client.setDomainInformation=function(n,t,i){globalDomainName=n;globalUserName=t;globalUserId=i;$("#team_name").text(globalDomainName);$("#team_menu_user_name").text(globalUserName)};myHub.client.updateRoomUsersCount=function(n){$("#channel_members_toggle_count_count").text(n);console.log("Updated roomUsersCount")};$.connection.hub.start().done(function(){console.log("Connected to Hub. Getting rooms");getRooms=myHub.server.getRooms();getPrivateConversations=myHub.server.getPrivateConversations();$.when(getRooms).then(function(){$.when(myHub.server.joinRoom(currentRoomId)).then(function(){console.log("Connected to room");var n=$(".menu > a.item.active");$("#channel_title").html($(n).html());getRoomInformation=myHub.server.getRoomInformation(currentRoomId);$.when(getRoomInformation).then(function(){loadingStop();$("#msg_form").keypress(function(n){if(n.which===13&&!n.shiftKey){var t=$("#msg_input").val().trim();t&&(console.log("Wysyłam: "+t+" do pokoju "+currentRoomId),myHub.server.sendMessage(currentRoomId,t));n.preventDefault();$("#msg_input").val("")}})})})})}).fail(function(n){console.log("Not connected! "+n)});$.connection.hub.error=function(n){console.warn(n)};$.connection.hub.stateChanged(function(n){n.newState===$.signalR.connectionState.reconnecting?(console.log("Re-connecting"),loadingStart()):n.newState===$.signalR.connectionState.connected&&console.log("The server is online")});$.connection.hub.reconnected(function(){console.log("Reconnected");loadingStop()});window.onbeforeunload=function(){$.connection.hub.stop()};$("#createNewChannel").click(function(){$("#createChanelForm")[0].reset();var n=$("input[name*='IsPublic']")[1];n.value=!1;thisModal=$(".ui.basic.create-room.modal");$(thisModal).modal({closable:!1,onDeny:function(){$(thisModal).parent().css("background-color","")},onApprove:function(){$(thisModal).parent().css("background-color","")}}).modal("show");$(thisModal).parent().css("background-color","#fff")});$("#createNewPrivateConversation").click(function(){$("#createPrivateConversationForm")[0].reset();$("#createPrivateConversationForm").find(".private-conversation-tag").each(function(n,t){console.log(t);$(t).remove()});myHub.server.getUsersFromDomain();var n=$(".ui.basic.create-private-conversation.modal");$(n).modal({closable:!1,onDeny:function(){$(n).parent().css("background-color","")},onApprove:function(){$(n).parent().css("background-color","")}}).modal("show");$(n).parent().css("background-color","#fff")});$("#myCheckBox").click(function(){$(this).is(":checked")?($("#createNewChannelHeader").html("Create a channel"),$("#createNewChannelLabel").html("Anyone on your team can view and join this channel"),$("input[name*='IsPublic']")[1].value=!0):($("#createNewChannelHeader").html("Create a private channel"),$("#createNewChannelLabel").html("This channel can only be joined by invite"),$("input[name*='IsPublic']")[1].value=!1)});$("#createChanelForm").submit(function(n){loadingStart();n.preventDefault();data=serializeForm($(this));myHub.server.createNewChannel(data);$(".ui.basic.create-room.modal").modal("hide")});$("#createPrivateConversationForm").submit(function(n){loadingStart();n.preventDefault();var t=[];$("#createPrivateConversationForm").find(".private-conversation-tag").each(function(n,i){var r=$(i),u=$(r).data("id");t.push(u)});myHub.server.createNewPrivateConversation(t);$(".ui.basic.create-private-conversation.modal").modal("hide")});myHub.client.broadcastEditedRoomDescription=function(n){descriptionInDatabase=n;$("#channel_topic_text").html(n)};myHub.client.broadcastEditedRoomCustomization=function(n){themeInDatabase=n.toString();changeTheme(themeInDatabase)};myHub.client.broadcastEditedActiveRoomName=function(n){roomNameInDatabase=n;$("#channel_title").contents().last().replaceWith(roomNameInDatabase);$("#channelsMenu > a.item.active").contents().last().replaceWith(roomNameInDatabase);$("#msg_input").attr("placeholder","Message "+roomNameInDatabase)};myHub.client.broadcastDomainEditedRoomName=function(n,t){$("#channelsMenu > a.item.active").data("id")!==n&&$("[data-id='"+n+"']").contents().last().replaceWith(t)};$("#channel_actions_toggle").click(function(){var n=$(".ui.sidebar.right");n.hasClass("visible")?$("#rightbar_Title").text()==="Channel Settings"?n.removeClass("visible"):($("#Rrightbar").html(""),n.addClass("visible"),$("#rightbar_Title").html("Channel Settings"),customization()):($("#Rrightbar").html(""),n.addClass("visible"),$("#rightbar_Title").html("Channel Settings"),customization())});closeRightBarCallback=function(){$(".ui.sidebar.right").removeClass("visible");changeTheme(themeInDatabase)};$("#closerightbar").click(function(){closeRightBarCallback()});$(document).keydown(function(n){n.keyCode===27&&$(".ui.sidebar.right").hasClass("visible")&&(console.log("Escape dla prawego sidebaru"),closeRightBarCallback())});$("#details_toggle").click(function(){var n=$(".ui.sidebar.right");myHub.server.getRoomInformation(currentRoomId);n.hasClass("visible")?$("#rightbar_Title").html()==="Channel Details"?n.removeClass("visible"):(n.addClass("visible"),membersInRoom()):(membersInRoom(),n.addClass("visible"))});$(document).on("click",".private-conversation-tag",function(){$(this).remove()});myHub.client.usersInRoom=function(n){$("#MembersInRoom").empty();$("#MembersInRoom").prev().contents().last().replaceWith(n.length+" Members");$.each(n,function(n,t){var i='<div class="row MembersInRoom-row" data-id="'+t.Id+'" data-name="'+t.Name+'">';i+='<div class="eight wide column"><i class="user icon"><\/i>'+t.Name+"<\/div>";i+="<\/div>";$("#MembersInRoom").append(i)})};myHub.client.roomInfo=function(n,t){console.log("Pobranie informacji z funkcji roomInfo()");$("#aboutInfo").empty();var i="<div>Created by "+n.OwnerName+" on "+t+"<\/div>";$("#aboutInfo").append(i);$("#infoDescription").val(n.Description);themeInDatabase=String(n.Customization);currentTheme=themeInDatabase;descriptionInDatabase=n.Description;roomNameInDatabase=n.Name;$("#channel_topic_text").html(descriptionInDatabase);$("#infoName").val(roomNameInDatabase);$("#msg_input").attr("placeholder","Message "+roomNameInDatabase);changeTheme(themeInDatabase);$(".ui.sidebar.right").hasClass("visible")&&$("#selecttheme").val(themeInDatabase)};