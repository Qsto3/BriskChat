function loadingStart(){$(".ui.main.container").css("display","none");$(".ui.dimmer").addClass("active")}function loadingStop(){$(".ui.main.container").css("display","block");$(".ui.dimmer").removeClass("active");console.log("Loader stops");addActionsToMessages()}function addActionsToMessages(){$(".ts-message").not(":has(> .action_hover_container), #message_edit_container").each(function(){$(this).prepend('<div class="action_hover_container stretch_btn_heights narrow_buttons" data-js="action_hover_container" data-show_rxn_action="true">            <button type="button" data-action="edit" class="btn_unstyle btn_msg_action ts_tip" data-content="Edit message" data-position="top center">            <i class="edit icon"><\/i>            <\/button>            <button type="button" data-action="delete" class="btn_unstyle btn_msg_action ts_tip danger" data-content="Delete message" data-position="top center">            <i class="delete icon"><\/i>            <\/button>            <\/div>')})}function addEditContainer(n,t,i){return'<div class="ts-message message highlight" id="message_edit_container">            <div class="message_gutter">                <div class="message_icon">                    '+i+'                <\/div>            <\/div>            <form id="message_edit_form" data-id="'+n+'">                <button class="btn_unstyle emo_menu" aria-label="Emoji menu" type="button">                    <i class="meh icon"><\/i>                <\/button>                <div id="msg_text" class="message_input ql-container focus">                    <div class="ql-editor" role="textbox" tabindex="0" aria-multiline="true" aria-haspopup="true" spellcheck="true" contenteditable="true"><p>'+t+'<\/p><\/div>                    <div class="ql-clipboard" tabindex="-1" aria-hidden="true" role="presentation" spellcheck="true" contenteditable="true"><\/div>                <\/div>                <a id="cancel_edit" role="button" class="ui button mini">Cancel<\/a>                <a id="commit_edit" role="button" class="ui button mini positive"><i class="icon edit"><\/i>Save Changes<\/a>                <span id="message_editing_info" class="mini" style="display: none;">Finish editing this message first! Or press <strong>escape<\/strong> if youve changed your mind.<\/span>            <\/form>        <\/div>'}function updateChannelsCount(n){var t=$("#channelsCount").text().match(/\d+/);t=parseInt(t)+n;$("#channelsCount").text("CHANNELS ("+t+")")}function serializeForm(n){data=$(n).serializeArray();var t={};return $.each(data,function(n,i){t[i.name]=i.value}),t}var Autolinker,myHub;$(".ui.sidebar.left").sidebar("setting",{transition:"overlay"});$(document).on("reloadPopups",function(){$(".ts_tip").popup({variation:"inverted"});$(".item > .btn_unstyle.right").popup({variation:"inverted"})});Autolinker=new Autolinker({stripPrefix:!1,stripTrailingSlash:!1});$(window).resize(function(){var n=117,t;$(".ui.message").length&&($(".ui.message").hasClass("hidden")||(n+=51));$("#chat_messages").height($(window).height()-n);t=165;$(".sidebar_channels_messages").height($(window).height()-t)});$(window).trigger("resize");currentRoomId=0;$.connection.hub.url="http://localhost:52284/signalr";myHub=$.connection.channelHub;$("#channelsCount").click(function(){console.log("Click na licznik kanałów");myHub.server.getDomainPublicRooms()});$(".menu").on("click",".menu > a.item",function(n){currentRoomId!=$(n.target).data("id")&&(loadingStart(),myHub.server.leaveRoom(currentRoomId),$(".menu > a.item.active").removeClass("active"),currentRoomId=$(n.target).data("id"),$.when(myHub.server.joinRoom(currentRoomId)).then(function(){$(n.target).addClass("active");$("#channel_title").html($(n.target).html());loadingStop();console.log("Current room ID: "+currentRoomId)}))});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='edit']",function(n){var t=$(n.target).closest(".ts-message"),i=t.data("id"),r=t.find(".message_body").text();t.hide();t.after(addEditContainer(i,r,t.find(".message_icon").html()));$(".ql-editor").focus();$(".ts-message").on("click","#cancel_edit",function(n){$(n.target).closest("#message_edit_container").remove();t.show()});$(document).keydown(function(n){n.keyCode===27&&(console.log("Escape keydown"),$(document).find("#message_edit_container").remove(),t.show())});$("#message_edit_form").keypress(function(n){if(n.which===13&&!n.shiftKey){if(r!==$(".ql-editor").text().trim()){var u;u===$(".ql-editor").text().trim()&&(console.log("Edytuję: "+u+" do pokoju "+currentRoomId),myHub.server.editMessage(currentRoomId,i,u))}$(n.target).closest("#message_edit_container").remove();t.show()}});$(".ts-message").on("click","#commit_edit",function(n){if(r!==$(".ql-editor").text().trim()){var u=$(".ql-editor").text().trim();u&&(console.log("Edytuję: "+u+" do pokoju "+currentRoomId),myHub.server.editMessage(currentRoomId,i,u))}$(n.target).closest("#message_edit_container").remove();t.show()})});$(".grid").on("click",".private-conversation-row",function(n){var t=$(n.target).hasClass(".private-conversation-row")?n.target:$(n.target).closest(".private-conversation-row");var i=$(t).data("name"),r=$(t).data("id"),u=$("#inputtext");u.before('<span class="private-conversation-tag" data-id="'+r+'">'+i+"<\/span>")});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='delete']",function(n){$(".ui.delete.modal").modal({onApprove:function(){var t=$(n.target).closest(".ts-message").data("id");myHub.server.deleteMessage(currentRoomId,t)}}).modal("show")});myHub.client.broadcastEditedMessage=function(n,t){var f=$(".ts-message[data-id='"+n+"']"),i=f.find(".message_body"),r,u;i.first().html(Autolinker.link(t));r=t.match(/watch\?v=([a-zA-Z0-9\-_]+)/);r?(u='<iframe src="https://www.youtube.com/embed/'+r[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe>',i.last().hasClass("youtube_iframe")?i.last().html(u):i.last().after(u)):i.last().hasClass("youtube_iframe")&&i.last().hide("slow",function(){i.last().remove()})};myHub.client.broadcastMessage=function(n,t,i,r){var u='<div class="ts-message" data-id="'+t+'"><div class="message_gutter"><div class="message_icon"><a href="/team/malgosia" target="/team/malgosia" class="member_image" data-member-id="U42KXAW07" style="background-image: url(\'../images/troll.png\')" aria-hidden="true" tabindex="-1"> <\/a><\/div><\/div><div class="message_content"><div class="message_content_header"><a href="#" class="message_sender">'+n+'<\/a><a href="#" class="timestamp">'+r+'<\/a><\/div><span class="message_body">'+Autolinker.link(i),f=i.match(/watch\?v=([a-zA-Z0-9\-_]+)/);u+=f?'<\/span><span class="message_body youtube_iframe"><iframe src="https://www.youtube.com/embed/'+f[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe><\/span><\/div><\/div>':"<\/span><\/div><\/div>";$("#chat_messages").append(u);$("#chat_messages").clearQueue();$("#chat_messages").animate({scrollTop:$("#chat_messages")[0].scrollHeight},"slow");addActionsToMessages();$(document).trigger("reloadPopups")};myHub.client.deleteMessage=function(n){var t=$(".ts-message[data-id='"+n+"']");console.log("Klient usuwa wiadomosc o ID: "+t.data("id"));t.hide("slow",function(){t.remove()})};myHub.client.loadRooms=function(n){var t=!0;$("#channelsCount").text("CHANNELS ("+n.length+")");$.each(n,function(n,i){var r='<a class="item';t&&(r+=" active",t=!1,currentRoomId=i.Id);r+='"data-id="'+i.Id+'" > ';r+=i.IsPublic?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=i.Name+"<\/a>";$("#channelsMenu").append(r)})};myHub.client.loadDomainPublicRooms=function(n){var t=!0;$("#channelsCount").text("CHANNELS ("+n.length+")");$.each(n,function(n,i){var r='<a class="item';t&&(r+=" active",t=!1,currentRoomId=i.Id);r+='"data-id="'+i.Id+'" > ';r+=i.IsPublic?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=i.Name+"<\/a>";$("#channelsMenu").append(r)})};myHub.client.loadPrivateConversations=function(n){$.each(n,function(n,t){var i='<a class="item" data-id="'+t.Id+'"><i class="icon left">#<\/i>'+t.Name+"<\/a>";$("#privateConversationsMenu").append(i)})};myHub.client.channelAddedAction=function(n,t,i){var r='<a class="item" data-id="'+t+'">';r+=i?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=n+"<\/a>";$("#channelsMenu").append(r);updateChannelsCount(1);loadingStop()};myHub.client.privateConversationAddedAction=function(n){var t='<a class="item" data-id="'+n.Id+'"><i class="icon left">#<\/i>'+n.Name+"<\/a>";$("#privateConversationsMenu").append(t);loadingStop()};myHub.client.privateConversationsUsersLoadedAction=function(n){$("#privateConversationsUserList").empty();$.each(n,function(n,t){var i='<div class="row private-conversation-row" data-id="'+t.Id+'" data-name="'+t.Name+'">';i+='<div class="eight wide column"><b>'+t.UserName+"<\/b> ";i+=t.IsOnline?'<i class="circle icon green"><\/i>':'<i class="circle thin icon"><\/i>';i+=t.Name+"<\/div>";i+='<div class="four wide column"><\/div>';i+='<div class="four wide column mycheckmark"><i class="checkmark icon"><\/i><\/div>';i+="<\/div>";$("#privateConversationsUserList").append(i)})};$.connection.hub.start().done(function(){console.log("Connected to Hub. Getting rooms");getRooms=myHub.server.getRooms();getPrivateConversations=myHub.server.getPrivateConversations();$.when(getRooms).then(function(){$.when(myHub.server.joinRoom(currentRoomId)).then(function(){console.log("Connected to room");var n=$(".menu > a.item.active");$("#channel_title").html($(n).html());loadingStop();$("#msg_form").keypress(function(n){if(n.which===13&&!n.shiftKey){var t=$("#msg_input").val().trim();t&&(console.log("Wysyłam: "+t+" do pokoju "+currentRoomId),myHub.server.sendMessage(currentRoomId,t));n.preventDefault();$("#msg_input").val("")}})})})}).fail(function(n){console.log("Not connected! "+n)});$.connection.hub.error=function(n){console.warn(n)};$.connection.hub.stateChanged(function(n){n.newState===$.signalR.connectionState.reconnecting?(console.log("Re-connecting"),loadingStart()):n.newState===$.signalR.connectionState.connected&&console.log("The server is online")});$.connection.hub.reconnected(function(){console.log("Reconnected");loadingStop()});window.onbeforeunload=function(){$.connection.hub.stop()};$("#createNewChannel").click(function(){$("#createChanelForm")[0].reset();var n=$("input[name*='IsPublic']")[1];n.value=!1;thisModal=$(".ui.basic.create-room.modal");$(thisModal).modal({closable:!1,onDeny:function(){$(thisModal).parent().css("background-color","")},onApprove:function(){$(thisModal).parent().css("background-color","")}}).modal("show");$(thisModal).parent().css("background-color","#fff")});$("#createNewPrivateConversation").click(function(){$("#createPrivateConversationForm")[0].reset();$("#createPrivateConversationForm").find(".private-conversation-tag").each(function(n,t){console.log(t);$(t).remove()});myHub.server.getUsersFromDomain();var n=$(".ui.basic.create-private-conversation.modal");$(n).modal({closable:!1,onDeny:function(){$(n).parent().css("background-color","")},onApprove:function(){$(n).parent().css("background-color","")}}).modal("show");$(n).parent().css("background-color","#fff")});$("#myCheckBox").click(function(){$(this).is(":checked")?($("#createNewChannelHeader").html("Create a channel"),$("#createNewChannelLabel").html("Anyone on your team can view and join this channel"),$("input[name*='IsPublic']")[1].value=!0):($("#createNewChannelHeader").html("Create a private channel"),$("#createNewChannelLabel").html("This channel can only be joined by invite"),$("input[name*='IsPublic']")[1].value=!1)});$("#createChanelForm").submit(function(n){loadingStart();n.preventDefault();data=serializeForm($(this));myHub.server.createNewChannel(data);$(".ui.basic.create-room.modal").modal("hide")});$("#createPrivateConversationForm").submit(function(n){loadingStart();n.preventDefault();var t=[];$("#createPrivateConversationForm").find(".private-conversation-tag").each(function(n,i){var r=$(i),u=$(r).data("id");t.push(u)});myHub.server.createNewPrivateConversation(t);$(".ui.basic.create-private-conversation.modal").modal("hide")});$(".ui.sidebar.vertical.inverted.right").first().sidebar("attach events",".toggle.button");$("#channel_actions_toggle").click(function(){var n=$(".ui.sidebar.vertical.inverted.right");n.hasClass("visible")?$("#rightbar_Title").text()=="Chanel Setings"?n.removeClass("visible"):($("#Rrightbar").html(""),n.addClass("visible"),$("#rightbar_Title").html("Chanel Setings")):($("#Rrightbar").html(""),n.addClass("visible"),$("#rightbar_Title").html("Chanel Setings"))});$("#closerightbar").click(function(){$(".ui.sidebar.vertical.inverted.right").removeClass("visible")});$("#details_toggle").click(function(){var n=$(".ui.sidebar.vertical.inverted.right");n.hasClass("visible")?$("#rightbar_Title").html()=="Chanel Details"?n.removeClass("visible"):(n.addClass("visible"),$("#Rrightbar").html(""),$("#rightbar_Title").html("Chanel Details"),$("#Rrightbar").append('<div class="ui styled accordion"><div class="active content"><div class="accordion"><div class="title"><i class="dropdown icon"><\/i><i class="info icon"><\/i>About<\/div><div class="content">Created by saibamen on March 31, 2017<\/div><div class="title"><i class="dropdown icon"><\/i><i class="users icon"><\/i>Members<\/div><div class="content" id="MembersInRoom"><\/div><\/div><\/div>'),$(".ui.styled.accordion").accordion(),myHub.server.getRoomUsers(currentRoomId)):(n.addClass("visible"),$("#Rrightbar").html(""),$("#rightbar_Title").html("Chanel Details"),$("#Rrightbar").append('<div class="ui styled accordion"><div class="active content"><div class="accordion"><div class="title"><i class="dropdown icon"><\/i><i class="info icon"><\/i>About<\/div><div class="content">Created by saibamen on March 31, 2017<\/div><div class="title"><i class="dropdown icon"><\/i><i class="users icon"><\/i>Members<\/div><div class="content" id="MembersInRoom"><\/div><\/div><\/div>'),$(".ui.styled.accordion").accordion(),myHub.server.getRoomUsers(currentRoomId))});$(document).on("click",".private-conversation-tag",function(){$(this).remove()});myHub.client.usersInRoom=function(n){$("#MembersInRoom").empty();$.each(n,function(n,t){var i='<div class="row MembersInRoom-row" data-id="'+t.Id+'" data-name="'+t.Name+'">';i+='<div class="eight wide column"><b><i class="user icon"><\/i><\/b> ';i+=t.Name+"<\/div>";i+='<div class="four wide column"><\/div>';i+='<div class="four wide column mycheckmark"><i class="checkmark icon"><\/i><\/div>';i+="<\/div>";$("#MembersInRoom").append(i)})};