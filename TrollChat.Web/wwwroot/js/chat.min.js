function loadingStart(){$(".ui.main.container").css("display","none");$(".ui.dimmer").addClass("active")}function loadingStop(){$(".ui.main.container").css("display","block");$(".ui.dimmer").removeClass("active");console.log("Loader stops");addActionsToMessages()}function addActionsToMessages(){$(".ts-message").not(":has(> .action_hover_container), #message_edit_container").each(function(){$(this).prepend('<div class="action_hover_container stretch_btn_heights narrow_buttons" data-js="action_hover_container" data-show_rxn_action="true">             <button type="button" data-action="edit" class="btn_unstyle btn_msg_action ts_tip" data-content="Edit message" data-position="top center">             <i class="edit icon"><\/i>             <\/button>             <button type="button" data-action="delete" class="btn_unstyle btn_msg_action ts_tip danger" data-content="Delete message" data-position="top center">             <i class="delete icon"><\/i>             <\/button>             <\/div>')})}function addEditContainer(n,t){return'<div class="ts-message message highlight" id="message_edit_container">            <div class="message_gutter">                <div class="message_icon">                    <a href="/team/saibamen" target="/team/saibamen" class=" member_preview_link member_image thumb_36" data-member-id="U4LLY4LSW" data-thumb-size="36" style="background-image: url(\'https://ca.slack-edge.com/T0MBAPD9S-U4LLY4LSW-6c900c6f67fc-48\')" aria-hidden="true" tabindex="-1"> <\/a>                <\/div>            <\/div>            <form id="message_edit_form" data-id="'+n+'">                <button class="btn_unstyle emo_menu" aria-label="Emoji menu" type="button">                    <i class="meh icon"><\/i>                <\/button>                <div id="msg_text" class="message_input ql-container focus">                    <div class="ql-editor" role="textbox" tabindex="0" aria-multiline="true" aria-haspopup="true" spellcheck="true" contenteditable="true"><p>'+t+'<\/p><\/div>                    <div class="ql-clipboard" tabindex="-1" aria-hidden="true" role="presentation" spellcheck="true" contenteditable="true"><\/div>                <\/div>                <a id="cancel_edit" role="button" class="ui button mini">Cancel<\/a>                <a id="commit_edit" role="button" class="ui button mini positive"><i class="icon edit"><\/i>Save Changes<\/a>                <span id="message_editing_info" class="mini" style="display: none;">Finish editing this message first! Or press <strong>escape<\/strong> if youve changed your mind.<\/span>            <\/form>        <\/div>'}function updateChannelsCount(n){var t=$("#channelsCount").text().match(/\d+/);t=parseInt(t)+n;$("#channelsCount").text("CHANNELS ("+t+")")}function serializeForm(n){data=$(n).serializeArray();var t={};return $.each(data,function(n,i){t[i.name]=i.value}),t}var Autolinker,myHub;$(".ui.sidebar.left").sidebar("setting",{transition:"overlay"});$(document).on("reloadPopups",function(){$(".ts_tip").popup({variation:"inverted"});$(".item > .btn_unstyle.right").popup({variation:"inverted"})});Autolinker=new Autolinker({stripPrefix:!1,stripTrailingSlash:!1});$(window).resize(function(){var n=117,t;$(".ui.message").length&&($(".ui.message").hasClass("hidden")||(n+=51));$("#chat_messages").height($(window).height()-n);t=165;$(".sidebar_channels_messages").height($(window).height()-t)});$(window).trigger("resize");currentRoomId=0;$.connection.hub.url="http://localhost:52284/signalr";myHub=$.connection.channelHub;$(".menu").on("click",".menu > a.item",function(n){currentRoomId!=$(n.target).data("id")&&(loadingStart(),myHub.server.leaveRoom(currentRoomId),$(".menu > a.item.active").removeClass("active"),currentRoomId=$(n.target).data("id"),$.when(myHub.server.joinRoom(currentRoomId)).then(function(){$(n.target).addClass("active");$("#channel_title").html($(n.target).html());loadingStop();console.log("Current room ID: "+currentRoomId)}))});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='edit']",function(n){var t=$(n.target).closest(".ts-message"),r=t.data("id"),i=t.find(".message_body").text();t.hide();t.after(addEditContainer(r,i));$(".ts-message").on("click","#cancel_edit",function(n){$(n.target).closest("#message_edit_container").remove();t.show()});$(".ts-message").on("click","#commit_edit",function(n){i==$(".ql-editor").text()&&($(n.target).closest("#message_edit_container").remove(),t.show())})});$("#chat_messages").on("click",".ts-message .btn_msg_action[data-action='delete']",function(n){$(".ui.delete.modal").modal({onApprove:function(){var t=$(n.target).closest(".ts-message").data("id");myHub.server.deleteMessage(currentRoomId,t)}}).modal("show")});myHub.client.broadcastMessage=function(n,t,i,r){var u='<div class="ts-message" data-id="'+t+'"><div class="message_gutter"><div class="message_icon"><a href="/team/malgosia" target="/team/malgosia" class="member_image" data-member-id="U42KXAW07" style="background-image: url(\'../images/troll.png\')" aria-hidden="true" tabindex="-1"> <\/a><\/div><\/div><div class="message_content"><div class="message_content_header"><a href="#" class="message_sender">'+n+'<\/a><a href="#" class="timestamp">'+r+'<\/a><\/div><span class="message_body">'+Autolinker.link(i),f=i.match(/watch\?v=([a-zA-Z0-9\-_]+)/);u+=f?'<\/span><span class="message_body"><iframe src="https://www.youtube.com/embed/'+f[1]+'?feature=oembed&amp;autoplay=0&amp;iv_load_policy=3" allowfullscreen="" height="300" frameborder="0" width="400"><\/iframe><\/span><\/div><\/div>':"<\/span><\/div><\/div>";$("#chat_messages").append(u);$("#chat_messages").clearQueue();$("#chat_messages").animate({scrollTop:$("#chat_messages")[0].scrollHeight},"slow");addActionsToMessages();$(document).trigger("reloadPopups")};myHub.client.deleteMessage=function(n){var t=$(".ts-message[data-id='"+n+"']");console.log("Klient usuwa wiadomosc o ID: "+t.data("id"));t.hide("slow",function(){t.remove()})};myHub.client.loadRooms=function(n){var t=!0;$("#channelsCount").text("CHANNELS ("+n.length+")");$.each(n,function(n,i){var r='<a class="item';t&&(r+=" active",t=!1,currentRoomId=i.Id);r+='"data-id="'+i.Id+'" > ';r+=i.IsPublic?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=i.Name+"<\/a>";$("#channelsMenu").append(r)})};myHub.client.loadPrivateConversations=function(n){$.each(n,function(n,t){var i='<a class="item';i+='"data-id="'+t.Id+'" > ';i+='<i class="icon left">#<\/i>';i+=t.UserName+"<\/a>";$("#privateConversationsMenu").append(i)})};myHub.client.channelAddedAction=function(n,t,i){var r='<a class="item" data-id="'+t+'">';r+=i?'<i class="icon left">#<\/i>':'<i class="lock icon left"><\/i>';r+=n+"<\/a>";$("#channelsMenu").append(r);updateChannelsCount(1);loadingStop()};myHub.client.privateConversationAddedAction=function(n,t){var i='<a class="item" data-id="'+t+'">';i+='<i class="icon left">#<\/i>';i+=n+"<\/a>";$("#privateConversationsMenu").append(i);loadingStop()};myHub.client.privateConversationsUsersLoadedAction=function(n){$.each(n,function(n,t){var i='<a class="item';setActive&&(i+=" active");i+='"data-id="'+t.Id+'" > ';i+='<i class="icon left">#<\/i>';i+=t.UserName+"<\/a>";$("#privateConversationsMenu").append(i)})};$.connection.hub.start().done(function(){console.log("Connected to Hub. Getting rooms");getRooms=myHub.server.getRooms();getPrivateConversations=myHub.server.getPrivateConversations();$.when(getRooms).then(function(){$.when(myHub.server.joinRoom(currentRoomId)).then(function(){console.log("Connected to room :)");var n=$(".menu > a.item.active");$("#channel_title").html($(n).html());loadingStop();$("#msg_form").keypress(function(n){n.which==13&&(n.shiftKey||((message=$("#msg_input").val().trim())&&(console.log("Wysy≈Çam: "+message+" do pokoju "+currentRoomId),myHub.server.sendMessage(currentRoomId,message)),n.preventDefault(),$("#msg_input").val("")))})})})}).fail(function(n){console.log("Not connected! "+n)});$.connection.hub.error=function(n){console.warn(n)};$.connection.hub.stateChanged(function(n){n.newState===$.signalR.connectionState.reconnecting?(console.log("Re-connecting"),loadingStart()):n.newState===$.signalR.connectionState.connected&&console.log("The server is online")});$.connection.hub.reconnected(function(){console.log("Reconnected");loadingStop()});$("#createNewChannel").click(function(){$("#createChanelForm")[0].reset();var n=$("input[name*='IsPublic']")[1];n.value=!1;thisModal=$(".ui.basic.create-room.modal");$(thisModal).modal({closable:!1,onDeny:function(){$(thisModal).parent().css("background-color","")},onApprove:function(){$(thisModal).parent().css("background-color","")}}).modal("show");$(thisModal).parent().css("background-color","#fff")});$("#createNewPrivateConversation").click(function(){$("#createPrivateConversationForm")[0].reset();myHub.server.getUsersFromDomain("123");thisModal=$(".ui.basic.create-private-conversation.modal");$(thisModal).modal({closable:!1,onDeny:function(){$(thisModal).parent().css("background-color","")},onApprove:function(){$(thisModal).parent().css("background-color","")}}).modal("show");$(thisModal).parent().css("background-color","#fff")});$("#myCheckBox").click(function(){$(this).is(":checked")?($("#createNewChannelHeader").html("Create a channel"),$("#createNewChannelLabel").html("Anyone on your team can view and join this channel"),$("input[name*='IsPublic']")[1].value=!0):($("#createNewChannelHeader").html("Create a private channel"),$("#createNewChannelLabel").html("This channel can only be joined by invite"),$("input[name*='IsPublic']")[1].value=!1)});$("#createChanelForm").submit(function(n){loadingStart();n.preventDefault();data=serializeForm($(this));myHub.server.createNewChannel(data);$(".ui.basic.create-room.modal").modal("hide")});$("#channel_actions_toggle").click(function(){var n=$(".ui.sidebar.vertical.inverted.right");n.hasClass("visible")?n.removeClass("visible"):(n.addClass("visible"),$("#rightbar_Title").html("Chanel Setings"))});$("#closerightbar").click(function(){$(".ui.sidebar.vertical.inverted.right").removeClass("visible")});$(".ui.sidebar.vertical.inverted.right").sidebar("setting",{transition:"overlay"});$("#details_toggle").click(function(){var n=$(".ui.sidebar.vertical.inverted.right");n.hasClass("visible")?n.removeClass("visible"):(n.addClass("visible"),$("#rightbar_Title").html("Chanel Details"))});